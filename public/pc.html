<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Client</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
</head>
<body>
<a-scene>
    <a-plane position="0 0 -4" rotation="-90 0 0" width="4" height="4" color="#7BC8A4"></a-plane>
    <a-sky color="#ECECEC"></a-sky>
    <a-entity id="camera" camera look-controls wasd-controls>
        <a-cursor color="#FF0000"></a-cursor>
    </a-entity>
</a-scene>

<script>
    const socket = io();
    const camera = document.getElementById('camera');

    // Отправка данных о местоположении и ориентации камеры
    setInterval(() => {
        const position = camera.getAttribute('position');
        const rotation = camera.getAttribute('rotation');
        socket.emit('updatePosition', {
            id: socket.id,
            position: position,
            rotation: rotation
        });
    }, 100);

    socket.on('updatePositions', (users) => {
        Object.keys(users).forEach((id) => {
            if (id !== socket.id) {
                let userEl = document.getElementById(`user-${id}`);
                if (!userEl) {
                    userEl = document.createElement('a-box');
                    userEl.setAttribute('id', `user-${id}`);
                    userEl.setAttribute('color', '#FF0000');
                    userEl.setAttribute('width', '0.5');
                    userEl.setAttribute('height', '0.5');
                    userEl.setAttribute('depth', '0.5');
                    document.querySelector('a-scene').appendChild(userEl);
                }
                userEl.setAttribute('position', users[id].position);
                userEl.setAttribute('rotation', users[id].rotation);
            }
        });
    });

    socket.on('spawnObject', (data) => {
        // Создание объекта на основе данных, полученных с сервера
        const newObject = document.createElement('a-box');
        newObject.setAttribute('position', `${data.position.x} ${data.position.y} ${data.position.z}`);
        newObject.setAttribute('rotation', `${data.rotation.x} ${data.rotation.y} ${data.rotation.z}`);
        newObject.setAttribute('color', '#00FF00');  // Можно изменить на другой цвет или тип объекта
        document.querySelector('a-scene').appendChild(newObject);
    });

    socket.on('initialObjectPositions', (objects) => {
        // Обработка начальных позиций объектов, если нужно
    });
</script>
</body>
</html>
